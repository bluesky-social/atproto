{
  "lexicon": 1,
  "id": "app.bsky.unspecced.getPostThreadV2",
  "defs": {
    "main": {
      "type": "query",
      "description": "(NOTE: this endpoint is under development and WILL change without notice. Don't use it until it is moved out of `unspecced` or your application WILL break) Get posts in a thread. It is based in an anchor post at any depth of the tree, and returns posts above it (recursively resolving the parent, without further branching) and below it (recursive replies, with branching). Does not require auth, but additional metadata and filtering will be applied for authed requests.",
      "parameters": {
        "type": "params",
        "required": ["uri"],
        "properties": {
          "uri": {
            "type": "string",
            "format": "at-uri",
            "description": "Reference (AT-URI) to post record."
          },
          "above": {
            "type": "integer",
            "description": "How many levels of parent (and grandparent, etc) to include above the anchor.",
            "default": 80,
            "minimum": 0,
            "maximum": 100
          },
          "below": {
            "type": "integer",
            "description": "How many levels of replies to include below the anchor.",
            "default": 6,
            "minimum": 0,
            "maximum": 100
          },
          "branchingFactor": {
            "type": "integer",
            "description": "Maximum of replies to include at each level of the thread, except for the direct replies to the anchor, which are (NOTE: currently, during unspecced phase) all returned (NOTE: later they might be paginated).",
            "default": 10,
            "minimum": 0,
            "maximum": 100
          },
          "prioritizeFollowedUsers": {
            "type": "boolean",
            "description": "Whether to prioritize posts from followed users. It only has effect when the user is authenticated.",
            "default": false
          },
          "sorting": {
            "type": "string",
            "description": "Sorting for the thread replies.",
            "knownValues": [
              "app.bsky.unspecced.getPostThreadV2#newest",
              "app.bsky.unspecced.getPostThreadV2#oldest",
              "app.bsky.unspecced.getPostThreadV2#top"
            ],
            "default": "app.bsky.unspecced.getPostThreadV2#oldest"
          }
        }
      },
      "output": {
        "encoding": "application/json",
        "schema": {
          "type": "object",
          "required": ["thread"],
          "properties": {
            "thread": {
              "type": "array",
              "description": "A flat list of thread items. The depth of each item is indicated by the depth property inside the item.",
              "items": {
                "type": "ref",
                "ref": "#threadItem"
              }
            },
            "threadgate": {
              "type": "ref",
              "ref": "app.bsky.feed.defs#threadgateView"
            }
          }
        }
      },
      "errors": [{ "name": "NotFound" }]
    },
    "newest": { "type": "token" },
    "oldest": { "type": "token" },
    "top": { "type": "token" },
    "threadItem": {
      "type": "object",
      "required": ["uri", "depth", "value"],
      "properties": {
        "uri": {
          "type": "string",
          "format": "at-uri"
        },
        "depth": {
          "type": "integer",
          "description": "The nesting level of this item in the thread. Depth 0 means the anchor item. Items above have negative depths, items below have positive depths."
        },
        "value": {
          "type": "union",
          "refs": [
            "#threadItemPost",
            "#threadItemNoUnauthenticated",
            "#threadItemNotFound",
            "#threadItemBlocked"
          ]
        }
      }
    },
    "hasReplies": { "type": "token" },
    "hiddenByThreadgate": { "type": "token" },
    "mutedByViewer": { "type": "token" },
    "opThread": { "type": "token" },
    "threadItemPost": {
      "type": "object",
      "required": ["post", "annotations"],
      "properties": {
        "post": { "type": "ref", "ref": "app.bsky.feed.defs#postView" },
        "annotations": {
          "type": "array",
          "description": "Annotations on this post that might be used by clients to customize experiences.",
          "items": {
            "type": "string",
            "knownValues": [
              "app.bsky.unspecced.getPostThreadV2#hasReplies",
              "app.bsky.unspecced.getPostThreadV2#hiddenByThreadgate",
              "app.bsky.unspecced.getPostThreadV2#mutedByViewer",
              "app.bsky.unspecced.getPostThreadV2#opThread"
            ]
          }
        }
      }
    },
    "threadItemNoUnauthenticated": {
      "type": "object",
      "properties": {}
    },
    "threadItemNotFound": {
      "type": "object",
      "properties": {}
    },
    "threadItemBlocked": {
      "type": "object",
      "required": ["author"],
      "properties": {
        "author": { "type": "ref", "ref": "app.bsky.feed.defs#blockedAuthor" }
      }
    }
  }
}
