{
  "lexicon": 1,
  "id": "tools.ozone.safelink.defs",
  "defs": {
    "event": {
      "type": "object",
      "description": "An event for URL safety decisions",
      "required": [
        "id",
        "eventType",
        "url",
        "pattern",
        "action",
        "reason",
        "createdBy",
        "createdAt"
      ],
      "properties": {
        "id": {
          "type": "integer",
          "description": "Auto-incrementing row ID"
        },
        "eventType": {
          "type": "ref",
          "ref": "#eventType"
        },
        "url": {
          "type": "string",
          "description": "The URL that this rule applies to"
        },
        "pattern": {
          "type": "ref",
          "ref": "#patternType"
        },
        "action": {
          "type": "ref",
          "ref": "#actionType"
        },
        "reason": {
          "type": "ref",
          "ref": "#reasonType"
        },
        "createdBy": {
          "type": "string",
          "format": "did",
          "description": "DID of the user who created this rule"
        },
        "createdAt": {
          "type": "string",
          "format": "datetime"
        },
        "comment": {
          "type": "string",
          "description": "Optional comment about the decision"
        }
      }
    },
    "eventType": {
      "type": "string",
      "knownValues": ["#addRule", "#updateRule", "#removeRule"]
    },
    "addRule": {
      "type": "token",
      "description": "Add a new URL safety rule"
    },
    "updateRule": {
      "type": "token",
      "description": "Update an existing URL safety rule"
    },
    "removeRule": {
      "type": "token",
      "description": "Remove an existing URL safety rule"
    },
    "patternType": {
      "type": "string",
      "knownValues": ["#domain", "#url"]
    },
    "domain": {
      "type": "token",
      "description": "Pattern type: Apply rule to entire domain"
    },
    "url": {
      "type": "token",
      "description": "Pattern type: Apply rule to specific URL"
    },
    "actionType": {
      "type": "string",
      "knownValues": ["#block", "#warn", "#whitelist"]
    },
    "block": {
      "type": "token",
      "description": "Action type: Block access to URL/domain"
    },
    "warn": {
      "type": "token",
      "description": "Action type: Show warning interstitial"
    },
    "whitelist": {
      "type": "token",
      "description": "Action type: Explicitly allow URL/domain"
    },
    "reasonType": {
      "type": "string",
      "knownValues": ["#csam", "#spam", "#phishing", "#none"]
    },
    "csam": {
      "type": "token",
      "description": "Reason type: Child Sexual Abuse Material"
    },
    "spam": {
      "type": "token",
      "description": "Reason type: Spam content"
    },
    "phishing": {
      "type": "token",
      "description": "Reason type: Phishing attempt"
    },
    "none": {
      "type": "token",
      "description": "Reason type: No specific reason"
    },
    "urlRule": {
      "type": "object",
      "description": "Input for creating a URL safety rule",
      "required": ["url", "pattern", "action", "reason"],
      "properties": {
        "url": {
          "type": "string",
          "description": "The URL or domain to apply the rule to"
        },
        "pattern": {
          "type": "ref",
          "ref": "#patternType"
        },
        "action": {
          "type": "ref",
          "ref": "#actionType"
        },
        "reason": {
          "type": "ref",
          "ref": "#reasonType"
        },
        "comment": {
          "type": "string",
          "description": "Optional comment about the decision"
        },
        "createdBy": {
          "type": "string",
          "format": "did",
          "description": "Optional DID to credit as the creator. Only respected for admin_token authentication."
        }
      }
    }
  }
}
