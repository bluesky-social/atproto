<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mock - OAuth Provider</title>
    <link rel="stylesheet" href="./src/style.css" />
  </head>
  <body>
    <div id="root"></div>
    <script>
      /*
       * This file's purpose is to provide a way to develop the UI without
       * running a full featured OAuth server. It mocks the server responses and
       * provides configuration data to the UI.
       *
       * This file is not part of the production build.
       *
       * Start the development server with the following command from the
       * oauth-provider root:
       *
       * ```sh
       * pnpm run start:ui
       * ```
       *
       * Then open the browser at http://localhost:5173/
       */
    </script>
    <style>
      :root {
        --hue-primary: 211;
        --hue-error: 346;
        --hue-warning: 47;
        --hue-success: 152;
      }
    </style>
    <script type="module">
      /*
       * PDS branding configuration
       */

      const name = 'Bluesky'
      const links = [
        {
          title: { en: 'Home' },
          href: 'https://bsky.social/',
          rel: 'canonical', // prevents the login page from being indexed by search engines
        },
        {
          title: { en: 'Terms of Service' },
          href: 'https://bsky.social/about/support/tos',
          rel: 'terms-of-service',
        },
        {
          title: { en: 'Privacy Policy' },
          href: 'https://bsky.social/about/support/privacy-policy',
          rel: 'privacy-policy',
        },
        {
          title: { en: 'Support' },
          href: 'https://blueskyweb.zendesk.com/hc/en-us',
          rel: 'help',
        },
      ]
      const logo = `<svg className='w-full' viewBox="0 0 536 120" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M26.445 7.202C40.432 17.662 55.475 38.871 61 50.251c5.524-11.38 20.568-32.589 34.555-43.049C105.647-.345 122-6.185 122 12.398c0 3.71-2.136 31.175-3.389 35.634-4.355 15.501-20.223 19.455-34.34 17.062 24.675 4.183 30.951 18.038 17.396 31.894-25.745 26.314-37.002-6.603-39.887-15.037-.529-1.546-.776-2.27-.78-1.654-.004-.615-.251.108-.78 1.654-2.884 8.434-14.142 41.351-39.887 15.037-13.555-13.856-7.279-27.711 17.395-31.894-14.116 2.393-29.984-1.56-34.34-17.062C2.137 43.572 0 16.109 0 12.398 0-6.185 16.353-.345 26.445 7.202Z" fill="var(--color-primary-500)"/><path d="M191.139 52.276c9.306 3.396 14.247 11.24 14.247 20.022 0 14.87-9.766 23.886-28.494 23.886h-38.26V12.818h36.996c17.809 0 26.426 9.25 26.426 21.544 0 8.196-3.677 14.167-10.915 17.914Zm-16.66-26.462h-20.337v21.779h20.337c7.928 0 12.179-4.215 12.179-11.24 0-6.44-4.366-10.539-12.179-10.539ZM154.142 83.07h21.945c8.732 0 13.443-4.098 13.443-11.474 0-7.728-4.481-11.592-13.443-11.592h-21.945V83.07ZM226.892 96.184h-14.477V12.818h14.477v83.366ZM274.892 69.605V35.767h14.477v60.417h-14.018v-8.782c-4.481 6.791-10.685 10.187-18.613 10.187-12.523 0-20.681-7.728-20.681-21.778V35.767h14.477v37.585c0 7.61 3.677 11.474 11.145 11.474 7.008 0 13.213-5.268 13.213-15.22ZM355.264 67.03v3.512h-44.35c1.034 10.42 6.664 15.572 15.396 15.572 6.664 0 11.145-2.927 13.558-8.664h13.902c-3.102 12.294-13.443 20.139-27.575 20.139-8.847 0-15.97-2.927-21.37-8.665-5.4-5.737-8.158-13.347-8.158-22.949 0-9.484 2.643-17.094 8.043-22.949 5.4-5.737 12.408-8.664 21.255-8.664 8.962 0 16.086 3.044 21.371 9.016 5.285 5.971 7.928 13.933 7.928 23.651ZM325.85 45.835c-7.927 0-13.442 4.684-14.821 14.402h29.758c-1.264-8.781-6.549-14.402-14.937-14.402ZM387.35 97.823c-17.235 0-26.311-6.908-27.115-20.841h14.132c.804 7.493 4.48 10.303 13.213 10.303 7.812 0 11.719-2.459 11.719-7.26 0-4.331-2.758-6.439-11.605-7.961l-6.778-1.17c-12.984-2.226-19.418-8.314-19.418-18.267 0-11.357 8.847-18.265 24.588-18.265 16.889 0 25.622 6.79 26.196 20.49h-13.673c-.344-7.376-4.595-9.952-12.523-9.952-6.894 0-10.341 2.342-10.341 7.025 0 4.215 2.988 6.089 9.881 7.376l7.468 1.171c14.362 2.693 20.567 8.08 20.567 18.383 0 12.177-9.651 18.968-26.311 18.968ZM477.2 96.184h-16.545l-17.234-28.101-8.962 9.133v18.968h-14.247V12.818h14.247v48.006l24.128-25.057h17.235l-22.405 22.832L477.2 96.184ZM515.282 50.988l4.826-15.221h15.166l-22.864 65.335c-2.413 6.674-5.4 11.474-9.192 14.167-3.791 2.693-9.191 3.981-16.315 3.981-2.413 0-4.481-.117-6.319-.351v-11.592h5.515c6.549 0 9.766-4.098 9.766-9.718 0-2.81-.919-6.908-2.758-12.177l-17.234-49.645h15.626l4.826 15.104c3.561 11.358 6.663 22.598 9.421 33.721 2.528-9.6 5.745-20.841 9.536-33.604Z" fill="var(--color-text-default)"/></svg>`

      // Provide a value here to test the "sing-in only" flow
      const loginHint = undefined // 'alice.test'

      // Use empty array to disable the "sing-up" flow, use a single value to
      // disable the domain selector.
      const availableUserDomains = ['.bsky.social', '.bsky.team']

      // Use non empty string to enable hCaptcha during "sing-up" flow
      const hcaptchaSiteKey = undefined

      /*
       * Client branding configuration
       */

      // Use an "http://" URL to test the "an app on your device" flow
      const clientId = 'https://example.com/client.json'
      const clientName = 'My App'
      const clientPolicyUri = 'https://bsky.app'
      const clientTosUri = 'https://bsky.app'
      const clientLogoUri = 'https://bsky.app'

      // Mock data

      const requestUri = 'foo-bar'

      document.cookie = `csrf-${requestUri}=xyz; path=/`

      window.__availableLocales = ['en', 'fr']

      window.__customizationData = {
        availableUserDomains,
        inviteCodeRequired: false,
        hcaptchaSiteKey,
        name,
        links,
        logo,
      }

      window.__authorizeData = {
        clientId: clientId,
        clientMetadata: {
          client_id: clientId,
          client_name: clientName,
          policy_uri: clientPolicyUri,
          tos_uri: clientTosUri,
          logo_uri: clientLogoUri,
        },
        clientTrusted: false,
        requestUri,
        loginHint,
        newSessionsRequireConsent: true,
        sessions: [
          {
            did: 'did:plc:3jpt2mvvsumj2r7eqk4gzzjz',
            account: {
              sub: 'did:plc:3jpt2mvvsumj2r7eqk4gzzjz',
              aud: '',
              email: 'eric@blueskyweb.xyz',
              email_verified: true,
              name: 'Eric',
              preferred_username: 'esb.lol',
              picture:
                'https://cdn.bsky.app/img/avatar/plain/did:plc:3jpt2mvvsumj2r7eqk4gzzjz/bafkreiaexnb3bkzbaxktm5q3l3txyweflh3smcruigesvroqjrqxec4zv4@jpeg',
            },
            selected: false,
            loginRequired: false,
            consentRequired: false,
          },
          {
            did: 'did:plc:dpajgwmnecpdyjyqzjzm6bnb',
            account: {
              sub: 'did:plc:dpajgwmnecpdyjyqzjzm6bnb',
              aud: '',
              email: 'eric@blueskyweb.xyz',
              email_verified: true,
              name: 'Tom Sawyer',
              preferred_username: 'test.esb.lol',
              picture:
                'https://cdn.bsky.app/img/avatar/plain/did:plc:dpajgwmnecpdyjyqzjzm6bnb/bafkreia6dx7fhoi6fxwfpgm7jrxijpqci7ap53wpilkpazojwvqlmgud2m@jpeg',
            },
            selected: false,
            loginRequired: false,
            consentRequired: false,
          },
        ],
        scopeDetails: [
          { scope: 'atproto' },
          { scope: 'transition:generic' },
          { scope: 'transition:chat.bsky' },
        ],
      }

      const origFetch = window.fetch

      async function mockFetch(...args) {
        const [input, init] = args

        if (typeof input === 'string' && init.method === 'POST') {
          const url = new URL(input, window.location)
          switch (url.pathname) {
            case '/oauth/authorize/sign-up':
            case '/oauth/authorize/sign-in':
              return new Response(
                JSON.stringify({
                  consentRequired: false,
                  account: {
                    sub: 'did:plc:123',
                    name: 'Alice',
                    email: 'alice@test.com',
                    email_verified: false,
                    preferred_username: 'alice.test',
                    picture: 'https://cat.com/cat.jpg',
                  },
                }),
                { status: 200 },
              )
            case '/oauth/authorize/verify-handle-availability':
            case '/oauth/authorize/reset-password-request':
            case '/oauth/authorize/reset-password-confirm':
              return new Response(null, { status: 204 })
          }
        }

        return origFetch.call(this, ...args)
      }

      Object.defineProperty(window, 'fetch', {
        value: mockFetch,
        writable: true,
        configurable: true,
      })
    </script>
    <script src="./src/index.tsx" type="module"></script>
  </body>
</html>
